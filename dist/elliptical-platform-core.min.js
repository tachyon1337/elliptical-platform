!function(global){"use strict";function detectObjectObserve(){function e(e){t=e}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var t=[],r={},n=[];return Object.observe(r,e),Array.observe(n,e),r.id=1,r.id=2,delete r.id,n.push(1,2),n.length=0,Object.deliverChangeRecords(e),5!==t.length?!1:"add"!=t[0].type||"update"!=t[1].type||"delete"!=t[2].type||"splice"!=t[3].type||"splice"!=t[4].type?!1:(Object.unobserve(r,e),Array.unobserve(n,e),!0)}function detectEval(){if("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime)return!1;if(navigator.getDeviceStorage)return!1;try{var e=new Function("","return true;");return e()}catch(t){return!1}}function isIndex(e){return+e===e>>>0}function toNumber(e){return+e}function isObject(e){return e===Object(e)}function areSameValue(e,t){return e===t?0!==e||1/e===1/t:numberIsNaN(e)&&numberIsNaN(t)?!0:e!==e&&t!==t}function getPathCharType(e){if(void 0===e)return"eof";var t=e.charCodeAt(0);switch(t){case 91:case 93:case 46:case 34:case 39:case 48:return e;case 95:case 36:return"ident";case 32:case 9:case 10:case 13:case 160:case 65279:case 8232:case 8233:return"ws"}return t>=97&&122>=t||t>=65&&90>=t?"ident":t>=49&&57>=t?"number":"else"}function noop(){}function parsePath(e){function t(){if(!(l>=e.length)){var t=e[l+1];return"inSingleQuote"==h&&"'"==t||"inDoubleQuote"==h&&'"'==t?(l++,n=t,d.append(),!0):void 0}}for(var r,n,i,o,s,a,c,u=[],l=-1,h="beforePath",d={push:function(){void 0!==i&&(u.push(i),i=void 0)},append:function(){void 0===i?i=n:i+=n}};h;)if(l++,r=e[l],"\\"!=r||!t(h)){if(o=getPathCharType(r),c=pathStateMachine[h],s=c[o]||c["else"]||"error","error"==s)return;if(h=s[0],a=d[s[1]]||noop,n=void 0===s[2]?r:s[2],a(),"afterPath"===h)return u}}function isIdent(e){return identRegExp.test(e)}function Path(e,t){if(t!==constructorIsPrivate)throw Error("Use Path.get to retrieve path objects");for(var r=0;r<e.length;r++)this.push(String(e[r]));hasEval&&this.length&&(this.getValueFrom=this.compiledGetValueFromFn())}function getPath(e){if(e instanceof Path)return e;if((null==e||0==e.length)&&(e=""),"string"!=typeof e){if(isIndex(e.length))return new Path(e,constructorIsPrivate);e=String(e)}var t=pathCache[e];if(t)return t;var r=parsePath(e);if(!r)return invalidPath;var t=new Path(r,constructorIsPrivate);return pathCache[e]=t,t}function formatAccessor(e){return isIndex(e)?"["+e+"]":'["'+e.replace(/"/g,'\\"')+'"]'}function dirtyCheck(e){for(var t=0;MAX_DIRTY_CHECK_CYCLES>t&&e.check_();)t++;return testingExposeCycleCount&&(global.dirtyCheckCycleCount=t),t>0}function objectIsEmpty(e){for(var t in e)return!1;return!0}function diffIsEmpty(e){return objectIsEmpty(e.added)&&objectIsEmpty(e.removed)&&objectIsEmpty(e.changed)}function diffObjectFromOldObject(e,t){var r={},n={},i={};for(var o in t){var s=e[o];(void 0===s||s!==t[o])&&(o in e?s!==t[o]&&(i[o]=s):n[o]=void 0)}for(var o in e)o in t||(r[o]=e[o]);return Array.isArray(e)&&e.length!==t.length&&(i.length=e.length),{added:r,removed:n,changed:i}}function runEOMTasks(){if(!eomTasks.length)return!1;for(var e=0;e<eomTasks.length;e++)eomTasks[e]();return eomTasks.length=0,!0}function newObservedObject(){function e(e){t&&t.state_===OPENED&&!n&&t.check_(e)}var t,r,n=!1,i=!0;return{open:function(r){if(t)throw Error("ObservedObject in use");i||Object.deliverChangeRecords(e),t=r,i=!1},observe:function(t,n){r=t,n?Array.observe(r,e):Object.observe(r,e)},deliver:function(t){n=t,Object.deliverChangeRecords(e),n=!1},close:function(){t=void 0,Object.unobserve(r,e),observedObjectCache.push(this)}}}function getObservedObject(e,t,r){var n=observedObjectCache.pop()||newObservedObject();return n.open(e),n.observe(t,r),n}function newObservedSet(){function e(t,o){t&&(t===n&&(i[o]=!0),a.indexOf(t)<0&&(a.push(t),Object.observe(t,r)),e(Object.getPrototypeOf(t),o))}function t(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.object!==n||i[r.name]||"setPrototype"===r.type)return!1}return!0}function r(r){if(!t(r)){for(var n,i=0;i<s.length;i++)n=s[i],n.state_==OPENED&&n.iterateObjects_(e);for(var i=0;i<s.length;i++)n=s[i],n.state_==OPENED&&n.check_()}}var n,i,o=0,s=[],a=[],c={object:void 0,objects:a,open:function(t,r){n||(n=r,i={}),s.push(t),o++,t.iterateObjects_(e)},close:function(){if(o--,!(o>0)){for(var e=0;e<a.length;e++)Object.unobserve(a[e],r),Observer.unobservedCount++;s.length=0,a.length=0,n=void 0,i=void 0,observedSetCache.push(this)}}};return c}function getObservedSet(e,t){return lastObservedSet&&lastObservedSet.object===t||(lastObservedSet=observedSetCache.pop()||newObservedSet(),lastObservedSet.object=t),lastObservedSet.open(e,t),lastObservedSet}function Observer(){this.state_=UNOPENED,this.callback_=void 0,this.target_=void 0,this.directObserver_=void 0,this.value_=void 0,this.id_=nextObserverId++}function addToAll(e){Observer._allObserversCount++,collectObservers&&allObservers.push(e)}function removeFromAll(){Observer._allObserversCount--}function ObjectObserver(e){Observer.call(this),this.value_=e,this.oldObject_=void 0}function ArrayObserver(e){if(!Array.isArray(e))throw Error("Provided object is not an Array");ObjectObserver.call(this,e)}function PathObserver(e,t){Observer.call(this),this.object_=e,this.path_=getPath(t),this.directObserver_=void 0}function CompoundObserver(e){Observer.call(this),this.reportChangesOnOpen_=e,this.value_=[],this.directObserver_=void 0,this.observed_=[]}function identFn(e){return e}function ObserverTransform(e,t,r,n){this.callback_=void 0,this.target_=void 0,this.value_=void 0,this.observable_=e,this.getValueFn_=t||identFn,this.setValueFn_=r||identFn,this.dontPassThroughSet_=n}function diffObjectFromChangeRecords(e,t,r){for(var n={},i={},o=0;o<t.length;o++){var s=t[o];expectedRecordTypes[s.type]?(s.name in r||(r[s.name]=s.oldValue),"update"!=s.type&&("add"!=s.type?s.name in n?(delete n[s.name],delete r[s.name]):i[s.name]=!0:s.name in i?delete i[s.name]:n[s.name]=!0)):(console.error("Unknown changeRecord type: "+s.type),console.error(s))}for(var a in n)n[a]=e[a];for(var a in i)i[a]=void 0;var c={};for(var a in r)if(!(a in n||a in i)){var u=e[a];r[a]!==u&&(c[a]=u)}return{added:n,removed:i,changed:c}}function newSplice(e,t,r){return{index:e,removed:t,addedCount:r}}function ArraySplice(){}function calcSplices(e,t,r,n,i,o){return arraySplice.calcSplices(e,t,r,n,i,o)}function intersect(e,t,r,n){return r>t||e>n?-1:t==r||n==e?0:r>e?n>t?t-r:n-r:t>n?n-e:t-e}function mergeSplice(e,t,r,n){for(var i=newSplice(t,r,n),o=!1,s=0,a=0;a<e.length;a++){var c=e[a];if(c.index+=s,!o){var u=intersect(i.index,i.index+i.removed.length,c.index,c.index+c.addedCount);if(u>=0){e.splice(a,1),a--,s-=c.addedCount-c.removed.length,i.addedCount+=c.addedCount-u;var l=i.removed.length+c.removed.length-u;if(i.addedCount||l){var r=c.removed;if(i.index<c.index){var h=i.removed.slice(0,c.index-i.index);Array.prototype.push.apply(h,r),r=h}if(i.index+i.removed.length>c.index+c.addedCount){var d=i.removed.slice(c.index+c.addedCount-i.index);Array.prototype.push.apply(r,d)}i.removed=r,c.index<i.index&&(i.index=c.index)}else o=!0}else if(i.index<c.index){o=!0,e.splice(a,0,i),a++;var v=i.addedCount-i.removed.length;c.index+=v,s+=v}}}o||e.push(i)}function createInitialSplices(e,t){for(var r=[],n=0;n<t.length;n++){var i=t[n];switch(i.type){case"splice":mergeSplice(r,i.index,i.removed.slice(),i.addedCount);break;case"add":case"update":case"delete":if(!isIndex(i.name))continue;var o=toNumber(i.name);if(0>o)continue;mergeSplice(r,o,[i.oldValue],1);break;default:console.error("Unexpected record type: "+JSON.stringify(i))}}return r}function projectArraySplices(e,t){var r=[];return createInitialSplices(e,t).forEach(function(t){return 1==t.addedCount&&1==t.removed.length?void(t.removed[0]!==e[t.index]&&r.push(t)):void(r=r.concat(calcSplices(e,t.index,t.index+t.addedCount,t.removed,0,t.removed.length)))}),r}var testingExposeCycleCount=global.testingExposeCycleCount,hasObserve=detectObjectObserve(),hasEval=detectEval(),numberIsNaN=global.Number.isNaN||function(e){return"number"==typeof e&&global.isNaN(e)},createObject="__proto__"in{}?function(e){return e}:function(e){var t=e.__proto__;if(!t)return e;var r=Object.create(t);return Object.getOwnPropertyNames(e).forEach(function(t){Object.defineProperty(r,t,Object.getOwnPropertyDescriptor(e,t))}),r},identStart="[$_a-zA-Z]",identPart="[$_a-zA-Z0-9]",identRegExp=new RegExp("^"+identStart+"+"+identPart+"*$"),pathStateMachine={beforePath:{ws:["beforePath"],ident:["inIdent","append"],"[":["beforeElement"],eof:["afterPath"]},inPath:{ws:["inPath"],".":["beforeIdent"],"[":["beforeElement"],eof:["afterPath"]},beforeIdent:{ws:["beforeIdent"],ident:["inIdent","append"]},inIdent:{ident:["inIdent","append"],0:["inIdent","append"],number:["inIdent","append"],ws:["inPath","push"],".":["beforeIdent","push"],"[":["beforeElement","push"],eof:["afterPath","push"]},beforeElement:{ws:["beforeElement"],0:["afterZero","append"],number:["inIndex","append"],"'":["inSingleQuote","append",""],'"':["inDoubleQuote","append",""]},afterZero:{ws:["afterElement","push"],"]":["inPath","push"]},inIndex:{0:["inIndex","append"],number:["inIndex","append"],ws:["afterElement"],"]":["inPath","push"]},inSingleQuote:{"'":["afterElement"],eof:["error"],"else":["inSingleQuote","append"]},inDoubleQuote:{'"':["afterElement"],eof:["error"],"else":["inDoubleQuote","append"]},afterElement:{ws:["afterElement"],"]":["inPath","push"]}},constructorIsPrivate={},pathCache={};Path.get=getPath,Path.prototype=createObject({__proto__:[],valid:!0,toString:function(){for(var e="",t=0;t<this.length;t++){var r=this[t];e+=isIdent(r)?t?"."+r:r:formatAccessor(r)}return e},getValueFrom:function(e){for(var t=0;t<this.length;t++){if(null==e)return;e=e[this[t]]}return e},iterateObjects:function(e,t){for(var r=0;r<this.length;r++){if(r&&(e=e[this[r-1]]),!isObject(e))return;t(e,this[0])}},compiledGetValueFromFn:function(){var e="",t="obj";e+="if (obj != null";for(var r,n=0;n<this.length-1;n++)r=this[n],t+=isIdent(r)?"."+r:formatAccessor(r),e+=" &&\n     "+t+" != null";e+=")\n";var r=this[n];return t+=isIdent(r)?"."+r:formatAccessor(r),e+="  return "+t+";\nelse\n  return undefined;",new Function("obj",e)},setValueFrom:function(e,t){if(!this.length)return!1;for(var r=0;r<this.length-1;r++){if(!isObject(e))return!1;e=e[this[r]]}return isObject(e)?(e[this[r]]=t,!0):!1}});var invalidPath=new Path("",constructorIsPrivate);invalidPath.valid=!1,invalidPath.getValueFrom=invalidPath.setValueFrom=function(){};var MAX_DIRTY_CHECK_CYCLES=1e3,eomTasks=[],runEOM=hasObserve?function(){var e={pingPong:!0},t=!1;return Object.observe(e,function(){runEOMTasks(),t=!1}),function(r){eomTasks.push(r),t||(t=!0,e.pingPong=!e.pingPong)}}():function(){return function(e){eomTasks.push(e)}}(),observedObjectCache=[],observedSetCache=[],lastObservedSet,UNOPENED=0,OPENED=1,CLOSED=2,RESETTING=3,nextObserverId=1;Observer.prototype={open:function(e,t){if(this.state_!=UNOPENED)throw Error("Observer has already been opened.");return addToAll(this),this.callback_=e,this.target_=t,this.connect_(),this.state_=OPENED,this.value_},close:function(){this.state_==OPENED&&(removeFromAll(this),this.disconnect_(),this.value_=void 0,this.callback_=void 0,this.target_=void 0,this.state_=CLOSED)},deliver:function(){this.state_==OPENED&&dirtyCheck(this)},report_:function(e){try{this.callback_.apply(this.target_,e)}catch(t){Observer._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(t.stack||t))}},discardChanges:function(){return this.check_(void 0,!0),this.value_}};var collectObservers=!hasObserve,allObservers;Observer._allObserversCount=0,collectObservers&&(allObservers=[]);var runningMicrotaskCheckpoint=!1,hasDebugForceFullDelivery=hasObserve&&hasEval&&function(){try{return eval("%RunMicrotasks()"),!0}catch(ex){return!1}}();global.Platform=global.Platform||{},global.Platform.performMicrotaskCheckpoint=function(){if(!runningMicrotaskCheckpoint){if(hasDebugForceFullDelivery)return void eval("%RunMicrotasks()");if(collectObservers){runningMicrotaskCheckpoint=!0;var cycles=0,anyChanged,toCheck;do{cycles++,toCheck=allObservers,allObservers=[],anyChanged=!1;for(var i=0;i<toCheck.length;i++){var observer=toCheck[i];observer.state_==OPENED&&(observer.check_()&&(anyChanged=!0),allObservers.push(observer))}runEOMTasks()&&(anyChanged=!0)}while(MAX_DIRTY_CHECK_CYCLES>cycles&&anyChanged);testingExposeCycleCount&&(global.dirtyCheckCycleCount=cycles),runningMicrotaskCheckpoint=!1}}},collectObservers&&(global.Platform.clearObservers=function(){allObservers=[]}),ObjectObserver.prototype=createObject({__proto__:Observer.prototype,arrayObserve:!1,connect_:function(){hasObserve?this.directObserver_=getObservedObject(this,this.value_,this.arrayObserve):this.oldObject_=this.copyObject(this.value_)},copyObject:function(e){var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=e[r];return Array.isArray(e)&&(t.length=e.length),t},check_:function(e){var t,r;if(hasObserve){if(!e)return!1;r={},t=diffObjectFromChangeRecords(this.value_,e,r)}else r=this.oldObject_,t=diffObjectFromOldObject(this.value_,this.oldObject_);return diffIsEmpty(t)?!1:(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([t.added||{},t.removed||{},t.changed||{},function(e){return r[e]}]),!0)},disconnect_:function(){hasObserve?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==OPENED&&(hasObserve?this.directObserver_.deliver(!1):dirtyCheck(this))},discardChanges:function(){return this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_),this.value_}}),ArrayObserver.prototype=createObject({__proto__:ObjectObserver.prototype,arrayObserve:!0,copyObject:function(e){return e.slice()},check_:function(e){var t;if(hasObserve){if(!e)return!1;t=projectArraySplices(this.value_,e)}else t=calcSplices(this.value_,0,this.value_.length,this.oldObject_,0,this.oldObject_.length);return t&&t.length?(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([t]),!0):!1}}),ArrayObserver.applySplices=function(e,t,r){r.forEach(function(r){for(var n=[r.index,r.removed.length],i=r.index;i<r.index+r.addedCount;)n.push(t[i]),i++;Array.prototype.splice.apply(e,n)})},PathObserver.prototype=createObject({__proto__:Observer.prototype,get path(){return this.path_},connect_:function(){hasObserve&&(this.directObserver_=getObservedSet(this,this.object_)),this.check_(void 0,!0)},disconnect_:function(){this.value_=void 0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},iterateObjects_:function(e){this.path_.iterateObjects(this.object_,e)},check_:function(e,t){var r=this.value_;return this.value_=this.path_.getValueFrom(this.object_),t||areSameValue(this.value_,r)?!1:(this.report_([this.value_,r,this]),!0)},setValue:function(e){this.path_&&this.path_.setValueFrom(this.object_,e)}});var observerSentinel={};CompoundObserver.prototype=createObject({__proto__:Observer.prototype,connect_:function(){if(hasObserve){for(var e,t=!1,r=0;r<this.observed_.length;r+=2)if(e=this.observed_[r],e!==observerSentinel){t=!0;break}t&&(this.directObserver_=getObservedSet(this,e))}this.check_(void 0,!this.reportChangesOnOpen_)},disconnect_:function(){for(var e=0;e<this.observed_.length;e+=2)this.observed_[e]===observerSentinel&&this.observed_[e+1].close();this.observed_.length=0,this.value_.length=0,this.directObserver_&&(this.directObserver_.close(this),this.directObserver_=void 0)},addPath:function(e,t){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add paths once started.");var t=getPath(t);if(this.observed_.push(e,t),this.reportChangesOnOpen_){var r=this.observed_.length/2-1;this.value_[r]=t.getValueFrom(e)}},addObserver:function(e){if(this.state_!=UNOPENED&&this.state_!=RESETTING)throw Error("Cannot add observers once started.");if(this.observed_.push(observerSentinel,e),this.reportChangesOnOpen_){var t=this.observed_.length/2-1;this.value_[t]=e.open(this.deliver,this)}},startReset:function(){if(this.state_!=OPENED)throw Error("Can only reset while open");this.state_=RESETTING,this.disconnect_()},finishReset:function(){if(this.state_!=RESETTING)throw Error("Can only finishReset after startReset");return this.state_=OPENED,this.connect_(),this.value_},iterateObjects_:function(e){for(var t,r=0;r<this.observed_.length;r+=2)t=this.observed_[r],t!==observerSentinel&&this.observed_[r+1].iterateObjects(t,e)},check_:function(e,t){for(var r,n=0;n<this.observed_.length;n+=2){var i,o=this.observed_[n],s=this.observed_[n+1];if(o===observerSentinel){var a=s;i=this.state_===UNOPENED?a.open(this.deliver,this):a.discardChanges()}else i=s.getValueFrom(o);t?this.value_[n/2]=i:areSameValue(i,this.value_[n/2])||(r=r||[],r[n/2]=this.value_[n/2],this.value_[n/2]=i)}return r?(this.report_([this.value_,r,this.observed_]),!0):!1}}),ObserverTransform.prototype={open:function(e,t){return this.callback_=e,this.target_=t,this.value_=this.getValueFn_(this.observable_.open(this.observedCallback_,this)),this.value_},observedCallback_:function(e){if(e=this.getValueFn_(e),!areSameValue(e,this.value_)){var t=this.value_;this.value_=e,this.callback_.call(this.target_,this.value_,t)}},discardChanges:function(){return this.value_=this.getValueFn_(this.observable_.discardChanges()),this.value_},deliver:function(){return this.observable_.deliver()},setValue:function(e){return e=this.setValueFn_(e),!this.dontPassThroughSet_&&this.observable_.setValue?this.observable_.setValue(e):void 0},close:function(){this.observable_&&this.observable_.close(),this.callback_=void 0,this.target_=void 0,this.observable_=void 0,this.value_=void 0,this.getValueFn_=void 0,this.setValueFn_=void 0}};var expectedRecordTypes={add:!0,update:!0,"delete":!0},EDIT_LEAVE=0,EDIT_UPDATE=1,EDIT_ADD=2,EDIT_DELETE=3;ArraySplice.prototype={calcEditDistances:function(e,t,r,n,i,o){for(var s=o-i+1,a=r-t+1,c=new Array(s),u=0;s>u;u++)c[u]=new Array(a),c[u][0]=u;for(var l=0;a>l;l++)c[0][l]=l;for(var u=1;s>u;u++)for(var l=1;a>l;l++)if(this.equals(e[t+l-1],n[i+u-1]))c[u][l]=c[u-1][l-1];else{var h=c[u-1][l]+1,d=c[u][l-1]+1;c[u][l]=d>h?h:d}return c},spliceOperationsFromEditDistances:function(e){for(var t=e.length-1,r=e[0].length-1,n=e[t][r],i=[];t>0||r>0;)if(0!=t)if(0!=r){var o,s=e[t-1][r-1],a=e[t-1][r],c=e[t][r-1];o=c>a?s>a?a:s:s>c?c:s,o==s?(s==n?i.push(EDIT_LEAVE):(i.push(EDIT_UPDATE),n=s),t--,r--):o==a?(i.push(EDIT_DELETE),t--,n=a):(i.push(EDIT_ADD),r--,n=c)}else i.push(EDIT_DELETE),t--;else i.push(EDIT_ADD),r--;return i.reverse(),i},calcSplices:function(e,t,r,n,i,o){var s=0,a=0,c=Math.min(r-t,o-i);if(0==t&&0==i&&(s=this.sharedPrefix(e,n,c)),r==e.length&&o==n.length&&(a=this.sharedSuffix(e,n,c-s)),t+=s,i+=s,r-=a,o-=a,r-t==0&&o-i==0)return[];if(t==r){for(var u=newSplice(t,[],0);o>i;)u.removed.push(n[i++]);return[u]}if(i==o)return[newSplice(t,[],r-t)];for(var l=this.spliceOperationsFromEditDistances(this.calcEditDistances(e,t,r,n,i,o)),u=void 0,h=[],d=t,v=i,f=0;f<l.length;f++)switch(l[f]){case EDIT_LEAVE:u&&(h.push(u),u=void 0),d++,v++;break;case EDIT_UPDATE:u||(u=newSplice(d,[],0)),u.addedCount++,d++,u.removed.push(n[v]),v++;break;case EDIT_ADD:u||(u=newSplice(d,[],0)),u.addedCount++,d++;break;case EDIT_DELETE:u||(u=newSplice(d,[],0)),u.removed.push(n[v]),v++}return u&&h.push(u),h},sharedPrefix:function(e,t,r){for(var n=0;r>n;n++)if(!this.equals(e[n],t[n]))return n;return r},sharedSuffix:function(e,t,r){for(var n=e.length,i=t.length,o=0;r>o&&this.equals(e[--n],t[--i]);)o++;return o},calculateSplices:function(e,t){return this.calcSplices(e,0,e.length,t,0,t.length)},equals:function(e,t){return e===t}};var arraySplice=new ArraySplice;global.Observer=Observer,global.Observer.runEOM_=runEOM,global.Observer.observerSentinel_=observerSentinel,global.Observer.hasObjectObserve=hasObserve,global.ArrayObserver=ArrayObserver,global.ArrayObserver.calculateSplices=function(e,t){return arraySplice.calculateSplices(e,t)},global.ArraySplice=ArraySplice,global.ObjectObserver=ObjectObserver,global.PathObserver=PathObserver,global.CompoundObserver=CompoundObserver,global.Path=Path,global.ObserverTransform=ObserverTransform}("undefined"!=typeof global&&global&&"undefined"!=typeof module&&module?global:this||window),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):(e._utils=e._utils||{},e._utils.forEach=t(),e.returnExports=e._utils.forEach)}(this,function(){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString;return function(r,n,i){if("[object Function]"!==t.call(n))throw new TypeError("iterator must be a function");var o=r.length;if(o===+o)for(var s=0;o>s;s++)n.call(i,r[s],s,r);else for(var a in r)e.call(r,a)&&n.call(i,r[a],a,r)}}),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("foreach")):"function"==typeof define&&define.amd?define(["foreach"],t):(e._utils.jsonPointer=t(e._utils.forEach),e.returnExports=e._utils.jsonPointer)}(this,function(e){function t(e,r,n){if(3===arguments.length)return t.set(e,r,n);if(2===arguments.length)return t.get(e,r);var i=t.bind(t,e);for(var o in t)t.hasOwnProperty(o)&&(i[o]=t[o].bind(i,e));return i}var r=e;return t.get=function(e,r){for(var n,i=t.parse(r);i.length;){if(n=i.shift(),!e.hasOwnProperty(n))throw new Error("Invalid reference token: "+n);e=e[n]}return e},t.set=function(e,r,n){for(var i,o=t.parse(r),s=o[0];o.length>1;)i=o.shift(),s=o[0],e.hasOwnProperty(i)||(e[i]=s.match(/^\d+$/)?[]:{}),e=e[i];return e[s]=n,this},t.remove=function(e,r){var n=t.parse(r),i=n.pop();if(void 0===i)throw new Error('Invalid JSON pointer for remove: "'+r+'"');delete t.get(e,t.compile(n))[i]},t.dict=function(e,r){var n={};return t.walk(e,function(e,t){n[t]=e},r),n},t.walk=function(e,n,i){var o=[];i=i||function(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t||"[object Array]"===t},function s(e){r(e,function(e,r){o.push(String(r)),i(e)?s(e):n(e,t.compile(o)),o.pop()})}(e)},t.has=function(e,r){try{t.get(e,r)}catch(n){return!1}return!0},t.escape=function(e){return e.toString().replace(/~/g,"~0").replace(/\//g,"~1")},t.unescape=function(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")},t.parse=function(e){if(""===e)return[];if("/"!==e.charAt(0))throw new Error("Invalid JSON pointer: "+e);return e.substring(1).split(/\//).map(t.unescape)},t.compile=function(e){return 0===e.length?"":"/"+e.map(t.escape).join("/")},t}),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("json-pointer")):"function"==typeof define&&define.amd?define(["json-pointer"],t):(e.Nested=t(e._utils.jsonPointer),e.returnExports=e.Nested)}(this,function(e){function t(e,t,r){return e.has(t)?-1!==e.get(t).indexOf(r):!1}function r(e,t,r){var n=(!e.has(t)&&e.set(t,[]),e.get(t));n.push(r)}function n(e,t,r){var n=e.get(t),i=n.indexOf(r);n.splice(i,1),n.length||e.delete(t)}var i=e,o=Object.create(null),s=new WeakMap,a=function(e){this.callback=e,this.observers=new WeakMap;var t=this;this.handleChangeRecords=function(e){try{var r=e.map(t.transform,t);r=Array.prototype.concat.apply([],r),t.callback(r)}catch(n){o.debug&&console.error(n.stack)}}};a.prototype.transform=function(e){var t=this.observers.get(e.object);return t=t.filter(function(e,t,r){return r.indexOf(e)===t}),t.map(function(t){return t.transform(e)})};var c=function(e,t,r){this.root=e,this.delegate=t,this.callback=t.handleChangeRecords,this.accept=r,this.paths=new WeakMap};return c.prototype.observe=function(e,n,o){if(n||(n=""),o||(o=new WeakMap),!o.has(e)){o.set(e,!0),t(this.delegate.observers,e,this)||(Array.isArray(e)&&!this.accept?Object.observe(e,this.callback,["add","update","delete","splice"]):Object.observe(e,this.callback,this.accept)),r(this.paths,e,n),r(this.delegate.observers,e,this);for(var s in e)"object"==typeof e[s]&&null!==e[s]&&this.observe(e[s],n+"/"+i.escape(s),o)}},c.prototype.unobserve=function(e,r){if(console.log(r),e||(e=this.root),r||(r=""),t(this.delegate.observers,e,this)){n(this.paths,e,r),n(this.delegate.observers,e,this),this.paths.has(e)||Object.unobserve(e,this.callback);for(var o in e)"object"==typeof e[o]&&this.unobserve(e[o],r+"/"+i.escape(o))}},c.prototype.transform=function(e){var t=String(e.name||e.index),r=this.paths.get(e.object)[0]+"/"+i.escape(t),n={root:this.root,path:r};for(var o in e)n[o]=e[o];var s=e.oldValue&&[e.oldValue]||e.removed||[];s.forEach(function(e){if(e&&"object"==typeof e){this.paths.get(e).filter(function(t){return!i.has(this.root,t)||i.get(this.root,t)!==e},this)}},this);var a=e.object[t];if("object"==typeof a){var c=Object.getOwnPropertyDescriptor(e.object,t);c.enumerable===!0?this.observe(a,r):this.unobserve(a,r)}return Object.preventExtensions(n),n},o.observe=function(e,t,r){if(void 0===e)return!1;var n;s.has(t)?n=s.get(t):(n=new a(t),s.set(t,n));var i=n.observers;if(!i.has(e)){var o=new c(e,n,r);o.observe(e)}},o.unobserve=function(e,t){if(s.has(t)){var r=s.get(t);if(r.observers.has(e)){console.log("nested unobserve");var n=r.observers.get(e);n.forEach(function(e){e.unobserve()})}}},o.deliverChangeRecords=function(e){if("function"!=typeof e)throw new TypeError("Callback must be a function, given: "+e);if(s.has(e)){var t=s.get(e);Object.deliverChangeRecords(t.handleChangeRecords)}},o.debug=!1,o}),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("observe-js"),require("elliptical-utils"),require("nested-observe")):"function"==typeof define&&define.amd?define(["observe-js","elliptical-utils","nested-observe"],t):e.returnExports=t(e,e.elliptical.utils,e.Nested)}(this,function(e,t,r){function n(){function e(e){t=e}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var t=[],r={},n=[];return Object.observe(r,e),Array.observe(n,e),r.id=1,r.id=2,delete r.id,n.push(1,2),n.length=0,Object.deliverChangeRecords(e),5!==t.length?!1:"add"!=t[0].type||"update"!=t[1].type||"delete"!=t[2].type||"splice"!=t[3].type||"splice"!=t[4].type?!1:(Object.unobserve(r,e),Array.unobserve(n,e),!0)}function i(e,t){var r={},n={},i={};for(var o in t){var s=e[o];(void 0===s||s!==t[o])&&(o in e?s!==t[o]&&(i[o]=s):n[o]=void 0)}for(var o in e)o in t||(r[o]=e[o]);return Array.isArray(e)&&e.length!==t.length&&(i.length=e.length),{added:r,removed:n,changed:i}}function o(e,t,r){var n=h.pop()||s();return n.open(e),n.observe(t,r),n}function s(){function e(e){t&&t.state_===l&&!n&&t.check_(e)}var t,r,n=!1,i=!0;return{open:function(r){if(t)throw Error("ObservedObject in use");i||Object.deliverChangeRecords(e),t=r,i=!1},observe:function(t,n){r=t,n?Array.observe(r,e):Object.observe(r,e)},deliver:function(t){n=t,Object.deliverChangeRecords(e),n=!1},close:function(){t=void 0,Object.unobserve(r,e),h.push(this)}}}function a(e,t,r){for(var n={},i={},o=0;o<t.length;o++){var s=t[o];d[s.type]?(s.name in r||(r[s.name]=s.oldValue),"update"!=s.type&&("add"!=s.type?s.name in n?(delete n[s.name],delete r[s.name]):i[s.name]=!0:s.name in i?delete i[s.name]:n[s.name]=!0)):(console.error("Unknown changeRecord type: "+s.type),console.error(s))}for(var a in n)n[a]=e[a];for(var a in i)i[a]=void 0;var c={};for(var a in r)if(!(a in n||a in i)){var u=e[a];r[a]!==u&&(c[a]=u)}return{added:n,removed:i,changed:c}}var c=t._,u=n(),l=1,h=[],d={add:!0,update:!0,"delete":!0},v=ObjectObserver.prototype;return ObjectObserver=function(e,t){Observer.call(this),this.value_=e,this.oldObject_=void 0,"undefined"!=typeof t&&(this.__id=t)},ObjectObserver.prototype=v,ObjectObserver.prototype.connect_=function(){u?"undefined"!==this.__id?r.observe(this.value_,this.check_.bind(this)):this.directObserver_=o(this,this.value_,this.arrayObserve):this.oldObject_="undefined"!==this.__id?c.cloneDeep(this.value_):this.copyObject(this.value_)},ObjectObserver.prototype.check_=function(e){if("undefined"!==this.__id){var r;if(u)return e?(r=t.nativeObjDiffReport(this.value_,e),this.callback_.call(this,r),!0):!1;if(c.isEqual(this.value_,this.oldObject_))return!1;var n=this.oldObject_;return this.oldObject_=c.cloneDeep(this.value_),r=t.objDiffReport(this.value_,n,this.__id),this.callback_.call(this,r),!0}var o,s;if(u){if(!e)return!1;s={},o=a(this.value_,e,s)}else s=this.oldObject_,o=i(this.value_,this.oldObject_);return diffIsEmpty(o)?!1:(u||(this.oldObject_=this.copyObject(this.value_)),this.report_([o.added||{},o.removed||{},o.changed||{},function(e){return s[e]}]),!0)},ObjectObserver.prototype.disconnect_=function(){u?"undefined"!==this.__id?r.unobserve(this.value_,function(){}):(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},e.ObjectObserver=ObjectObserver,e}),function(){"use strict";function e(e){for(;e.parentNode;)e=e.parentNode;return"function"==typeof e.getElementById?e:null}function t(e,t,r){var n=e.bindings_;return n||(n=e.bindings_={}),n[t]&&(r[t]?r[t].close():n[t].close()),n[t]=r}function r(e,t,r){return r}function n(e){return null==e?"":e}function i(e,t){e.data=n(t)}function o(e){return function(t){return i(e,t)}}function s(e,t,r,i){return r?void(i?e.setAttribute(t,""):e.removeAttribute(t)):void e.setAttribute(t,n(i))}function a(e,t,r){return function(n){s(e,t,r,n)}}function c(e){switch(e.type){case"checkbox":return y;case"radio":case"select-multiple":case"select-one":return"change";case"range":if(/Trident|MSIE/.test(navigator.userAgent))return"change";default:return"input"}}function u(e,t,r,i){e[t]=(i||n)(r)}function l(e,t,r){return function(n){return u(e,t,n,r)}}function h(){}function d(e,t,r,n){function i(){r.setValue(e[t]),r.discardChanges(),(n||h)(e),Platform.performMicrotaskCheckpoint()}var o=c(e);return e.addEventListener(o,i),{close:function(){e.removeEventListener(o,i),r.close()},observable_:r}}function v(e){return Boolean(e)}function f(t){if(t.form)return O(t.form.elements,function(e){return e!=t&&"INPUT"==e.tagName&&"radio"==e.type&&e.name==t.name});var r=e(t);if(!r)return[];var n=r.querySelectorAll('input[type="radio"][name="'+t.name+'"]');return O(n,function(e){return e!=t&&!e.form})}function b(e){"INPUT"===e.tagName&&"radio"===e.type&&f(e).forEach(function(e){var t=e.bindings_.checked;t&&t.observable_.setValue(!1)})}function p(e,t){var r,i,o,s=e.parentNode;s instanceof HTMLSelectElement&&s.bindings_&&s.bindings_.value&&(r=s,i=r.bindings_.value,o=r.value),e.value=n(t),r&&r.value!=o&&(i.observable_.setValue(r.value),i.observable_.discardChanges(),Platform.performMicrotaskCheckpoint())}function _(e){return function(t){p(e,t)}}var O=Array.prototype.filter.call.bind(Array.prototype.filter);Node.prototype.bind=function(e,t){console.error("Unhandled binding to Node: ",this,e,t)},Node.prototype.bindFinished=function(){};var g=r;Object.defineProperty(Platform,"enableBindingsReflection",{get:function(){return g===t},set:function(e){return g=e?t:r,e},configurable:!0}),Text.prototype.bind=function(e,t,r){if("textContent"!==e)return Node.prototype.bind.call(this,e,t,r);if(r)return i(this,t);var n=t;return i(this,n.open(o(this))),g(this,e,n)},Element.prototype.bind=function(e,t,r){var n="?"==e[e.length-1];if(n&&(this.removeAttribute(e),e=e.slice(0,-1)),r)return s(this,e,n,t);var i=t;return s(this,e,n,i.open(a(this,e,n))),g(this,e,i)};var y;!function(){var e=document.createElement("div"),t=e.appendChild(document.createElement("input"));t.setAttribute("type","checkbox");var r,n=0;t.addEventListener("click",function(){n++,r=r||"click"}),t.addEventListener("change",function(){n++,r=r||"change"});var i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(i),y=1==n?"change":r}(),HTMLInputElement.prototype.bind=function(e,r,i){if("value"!==e&&"checked"!==e)return HTMLElement.prototype.bind.call(this,e,r,i);this.removeAttribute(e);var o="checked"==e?v:n,s="checked"==e?b:h;if(i)return u(this,e,r,o);var a=r,c=d(this,e,a,s);return u(this,e,a.open(l(this,e,o)),o),t(this,e,c)},HTMLTextAreaElement.prototype.bind=function(e,t,r){if("value"!==e)return HTMLElement.prototype.bind.call(this,e,t,r);if(this.removeAttribute("value"),r)return u(this,"value",t);var i=t,o=d(this,"value",i);
return u(this,"value",i.open(l(this,"value",n))),g(this,e,o)},HTMLOptionElement.prototype.bind=function(e,t,r){if("value"!==e)return HTMLElement.prototype.bind.call(this,e,t,r);if(this.removeAttribute("value"),r)return p(this,t);var n=t,i=d(this,"value",n);return p(this,n.open(_(this))),g(this,e,i)},HTMLSelectElement.prototype.bind=function(e,r,n){if("selectedindex"===e&&(e="selectedIndex"),"selectedIndex"!==e&&"value"!==e)return HTMLElement.prototype.bind.call(this,e,r,n);if(this.removeAttribute(e),n)return u(this,e,r);var i=r,o=d(this,e,i);return u(this,e,i.open(l(this,e))),t(this,e,o)}}(this);